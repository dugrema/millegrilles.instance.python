{
  "name": "mq",
  "certificat": {"roles": ["mq"], "dns": {"localhost": true, "hostnames": ["mq"], "domain": true}},
  "password": ["mqadmin"],
  "env": [
    "MG_KEY=/run/secrets/key.pem",
    "WEB_KEY=/run/secrets/webkey.pem",
    "CONFIG_FILE=/opt/rabbitmq/dist/config/rabbitmq_ipv6management.config",
    "NODENAME=rabbit@mq"
  ],
  "mounts": ["rabbitmq-data:/var/lib/rabbitmq:rw"],
  "constraints": ["node.labels.millegrilles.mq == true"],
  "configs": [
    {
      "name": "pki.millegrille",
      "filename": "/opt/rabbitmq/dist/certs/calist.cert.pem"
    },
    {
      "certificate": true,
      "filename": "/opt/rabbitmq/dist/certs/cert.pem"
    },
    {
      "certificate": true,
      "filename": "/opt/rabbitmq/dist/certs/webcert.pem"
    }
  ],
  "secrets": [
    {
      "key": true,
      "filename": "key.pem"
    },
    {
      "key": true,
      "filename": "webkey.pem"
    }
  ],
  "endpoint_spec": {
    "mode": "vip",
    "ports": [
      {
        "published_port": 8443,
        "target_port": 8443,
        "protocol": "tcp"
      },{
        "published_port": 5673,
        "target_port": 5673,
        "protocol": "tcp"
      }
    ]
  },
  "networks": [{
    "target": "millegrille_net",
    "aliases": ["mq"]
  }],
  "labels": {
    "millegrille": "${IDMG}"
  },
  "resources": {
    "cpu_limit": 2000000000,
    "mem_limit": 629145600
  },
  "mode": {
    "mode": "replicated",
    "replicas": 1
  }
}
